.TH SHCLAP 1 "January 2026" "shclap 0.1.0" "User Commands"
.SH NAME
shclap \- clap-style argument parsing for shell scripts
.SH SYNOPSIS
.B shclap parse
.RB [ \-\-name
.IR NAME ]
.RB [ \-\-prefix
.IR PREFIX ]
.B \-\-config
.I JSON
.B \-\-
.IR ARGS ...
.br
.B shclap help
.RB [ \-\-name
.IR NAME ]
.B \-\-config
.I JSON
.br
.B shclap version
.RB [ \-\-name
.IR NAME ]
.B \-\-config
.I JSON
.br
.B shclap print
.RB [ \-\-name
.IR NAME ]
.RB [ \-\-prefix
.IR PREFIX ]
.B \-\-config
.I JSON
.SH DESCRIPTION
.B shclap
brings clap-style argument parsing to shell scripts. Define your CLI
interface via JSON configuration, and shclap validates arguments and
outputs a sourceable file with environment variables.
.PP
The typical usage pattern is:
.PP
.RS
.nf
source $(shclap parse \-\-config "$CONFIG" \-\- "$@")
.fi
.RE
.PP
After sourcing, parsed arguments are available as environment variables
with the configured prefix (default: SHCLAP_).
.SH COMMANDS
.TP
.B parse
Parse script arguments and output a temp file path. The temp file contains
shell export statements that can be sourced. On error or when \-\-help/\-\-version
is requested, the temp file contains appropriate output and exit commands.
.TP
.B help
Print the help text for the target script (as defined in the JSON config)
directly to stdout.
.TP
.B version
Print the version of the target script (as defined in the JSON config)
directly to stdout.
.TP
.B print
Reconstruct and print how the script was called by reading current
environment variables. Useful for logging or debugging. Converts env
var values back to their flag/option format.
.SH OPTIONS
.SS "Parse Command Options"
.TP
.BI \-\-config " JSON"
JSON configuration string defining the script's arguments. Required.
.TP
.BI \-\-name " NAME"
Application name. Overrides the name specified in config. If neither CLI
\-\-name nor config "name" field is provided, shclap returns an error.
.TP
.BI \-\-prefix " PREFIX"
Environment variable prefix. Overrides the prefix specified in config.
Default: SHCLAP_
.TP
.B \-\-
Separator between shclap options and the script arguments to parse.
.SS "Global Options"
.TP
.BR \-h ", " \-\-help
Print help information.
.TP
.BR \-V ", " \-\-version
Print shclap version.
.SH JSON CONFIGURATION
The JSON configuration defines the script's command-line interface:
.PP
.RS
.nf
{
  "schema_version": 1,
  "name": "myscript",
  "description": "My script description",
  "version": "1.0.0",
  "prefix": "MYAPP_",
  "args": [
    {
      "name": "verbose",
      "short": "v",
      "long": "verbose",
      "type": "flag",
      "help": "Enable verbose output"
    },
    {
      "name": "output",
      "short": "o",
      "long": "output",
      "type": "option",
      "required": true,
      "help": "Output file"
    },
    {
      "name": "input",
      "type": "positional",
      "required": true,
      "help": "Input file"
    }
  ]
}
.fi
.RE
.SS "Top-Level Fields"
.TP
.B schema_version
Schema version number. Optional, defaults to 1. Set to 2 to enable extended
features like environment variable fallback, multiple values, and subcommands.
.TP
.B name
Script name. Optional if provided via CLI \-\-name flag. Used in help output.
.TP
.B description
Script description. Optional. Shown in help output.
.TP
.B version
Script version. Optional. Shown with \-V/\-\-version.
.TP
.B prefix
Environment variable prefix. Optional. Default: "SHCLAP_"
.TP
.B args
Array of argument definitions. Optional.
.SS "Argument Fields"
.TP
.B name
Argument name. Required. Becomes the environment variable name
(uppercased, with the prefix).
.TP
.B short
Single-character short option (e.g., "v" for \-v). Optional.
.TP
.B long
Long option name (e.g., "verbose" for \-\-verbose). Optional.
.TP
.B type
Argument type. Required. One of:
.RS
.TP
.B flag
Boolean switch. Sets variable to "true" or "false".
.TP
.B option
Takes a value. Supports \-o value, \-ovalue, \-\-opt value, \-\-opt=value.
.TP
.B positional
Positional argument (no dash prefix).
.RE
.TP
.B required
Whether the argument is required. Optional, default: false.
.TP
.B default
Default value if not provided. Optional.
.TP
.B help
Help text for this argument. Optional.
.SS "Schema Version 2 Argument Fields"
Set schema_version to 2 to enable these additional argument fields:
.TP
.B env
Controls environment variable fallback. In schema v2, arguments automatically
fall back to PREFIX + ARG_NAME (e.g., SHCLAP_CONFIG for --config). Use this
field to customize: set to \fBfalse\fR to disable env fallback, or set to a
string like "CUSTOM_VAR" to use a specific variable name.
.TP
.B multiple
Boolean. Allow multiple occurrences of this argument. Output as bash array.
For flags, counts occurrences (e.g., \-vvv sets variable to "3").
.TP
.B num_args
Value count per occurrence. Examples: "2" (exactly 2), "1.." (1 or more),
"1..3" (1 to 3), "1..=3" (1 to 3 inclusive).
.TP
.B delimiter
Character to split a single value into multiple. E.g., "," splits
"a,b,c" into ("a" "b" "c").
.TP
.B choices
Array of allowed values for this argument. Invalid values are rejected with
a clear error message listing valid options. Cannot be used with flags.
Example: ["json", "yaml", "toml"]
.TP
.B value_type
Value type validation. One of: "string" (default, no validation), "int"
(signed 64-bit integer), or "bool" (strict true/false only). Cannot be used
with flags. If both choices and value_type are specified, choices takes
precedence.
.SS "Subcommands (Schema Version 2)"
.TP
.B subcommands
Top-level array of subcommand definitions. When subcommands are defined, one must be
provided. Each subcommand has:
.RS
.TP
.B name
Subcommand name (required).
.TP
.B help
Help text for the subcommand (optional).
.TP
.B args
Array of argument definitions for this subcommand (optional).
.RE
.SH OUTPUT FORMAT
.SS "Scalar Values"
Single values are exported as quoted strings:
.PP
.RS
export SHCLAP_OUTPUT="value"
.RE
.SS "Array Values (Schema Version 2)"
Multiple values are exported as bash arrays:
.PP
.RS
export SHCLAP_FILES=("file1.txt" "file2.txt")
.RE
.PP
Access array elements with ${VAR[@]} or ${VAR[0]}, ${VAR[1]}, etc.
.SS "Subcommand Name (Schema Version 2)"
When subcommands are used, the selected subcommand is exported:
.PP
.RS
export SHCLAP_SUBCOMMAND="init"
.RE
.SH BUILT-IN FLAGS
The following flags are automatically handled by shclap during parsing:
.TP
.BR \-h ", " \-\-help
Display help for the target script and exit 0.
.TP
.BR \-V ", " \-\-version
Display version of the target script and exit 0.
.PP
These flags take precedence over normal argument parsing. If \-\-help
is present anywhere in the arguments, help is shown. If \-\-version is
present (and \-\-help is not), version is shown.
.SH EXIT STATUS
The
.B shclap parse
command always outputs a temp file path to stdout. The sourced file
handles the actual exit:
.TP
.B 0
Successful parse, or \-\-help/\-\-version requested.
.TP
.B 1
Parse error (unknown option, missing required argument, etc.).
.SH ERROR MESSAGES
When parsing fails, errors are delivered via the sourced temp file, which
prints to stderr and exits. Common error formats:
.TP
.B Unknown option
shclap: unknown option: \-\-foo
.TP
.B Missing required argument
shclap: missing required argument: input
.TP
.B Missing value for option
shclap: missing value for option: \-\-output
.TP
.B Invalid choice
shclap: invalid value 'xml' for '\-\-format': valid values: json, yaml, toml
.TP
.B Invalid type (int)
shclap: invalid digit found in string
.TP
.B Invalid type (bool)
shclap: invalid value 'yes': valid values: true, false
.TP
.B Invalid JSON config
shclap: failed to parse JSON config: ...
.TP
.B Duplicate argument name
shclap: duplicate argument name: verbose
.TP
.B Unsupported schema version
shclap: unsupported schema version 99 (supported: 1-2)
.SH EXAMPLES
.SS "Basic Script"
.PP
.RS
.nf
#!/bin/bash
CONFIG='{
  "name": "greet",
  "version": "1.0.0",
  "args": [
    {"name": "name", "type": "positional", "required": true, "help": "Name to greet"}
  ]
}'
source $(shclap parse \-\-config "$CONFIG" \-\- "$@")
echo "Hello, $SHCLAP_NAME!"
.fi
.RE
.SS "With Flags and Options"
.PP
.RS
.nf
#!/bin/bash
CONFIG='{
  "name": "backup",
  "description": "Backup files to destination",
  "version": "2.0.0",
  "prefix": "BACKUP_",
  "args": [
    {"name": "verbose", "short": "v", "type": "flag", "help": "Verbose output"},
    {"name": "compress", "short": "c", "type": "flag", "help": "Compress backup"},
    {"name": "dest", "short": "d", "long": "destination", "type": "option",
     "required": true, "help": "Destination directory"},
    {"name": "source", "type": "positional", "required": true, "help": "Source path"}
  ]
}'
source $(shclap parse \-\-config "$CONFIG" \-\- "$@")

[[ "$BACKUP_VERBOSE" == "true" ]] && echo "Backing up $BACKUP_SOURCE to $BACKUP_DEST"
# ... rest of script
.fi
.RE
.SS "Environment Variable Fallback (Schema V2)"
.PP
In schema v2, arguments automatically fall back to PREFIX + ARG_NAME:
.PP
.RS
.nf
#!/bin/bash
CONFIG='{
  "schema_version": 2,
  "name": "deploy",
  "prefix": "DEPLOY_",
  "args": [
    {"name": "token", "long": "token", "type": "option", "required": true},
    {"name": "secret", "long": "secret", "type": "option", "env": false}
  ]
}'
source $(shclap parse \-\-config "$CONFIG" \-\- "$@")
# $DEPLOY_TOKEN comes from \-\-token or $DEPLOY_TOKEN env var (auto)
# $DEPLOY_SECRET only comes from \-\-secret (env disabled)
.fi
.RE
.SS "Multiple Values (Schema V2)"
.PP
.RS
.nf
#!/bin/bash
CONFIG='{
  "schema_version": 2,
  "name": "process",
  "args": [
    {"name": "files", "long": "file", "type": "option", "multiple": true,
     "help": "Files to process"}
  ]
}'
source $(shclap parse \-\-config "$CONFIG" \-\- \-\-file a.txt \-\-file b.txt)
for f in "${SHCLAP_FILES[@]}"; do
  echo "Processing $f"
done
.fi
.RE
.SS "Subcommands (Schema V2)"
.PP
.RS
.nf
#!/bin/bash
CONFIG='{
  "schema_version": 2,
  "name": "project",
  "subcommands": [
    {"name": "init", "help": "Initialize project",
     "args": [{"name": "template", "type": "positional", "default": "default"}]},
    {"name": "build", "help": "Build project",
     "args": [{"name": "release", "short": "r", "type": "flag"}]}
  ]
}'
source $(shclap parse \-\-config "$CONFIG" \-\- "$@")
case "$SHCLAP_SUBCOMMAND" in
  init) echo "Template: $SHCLAP_TEMPLATE" ;;
  build) [[ "$SHCLAP_RELEASE" == "true" ]] && echo "Release build" ;;
esac
.fi
.RE
.SH SEE ALSO
.BR bash (1),
.BR getopt (1)
.SH BUGS
Report bugs at: https://github.com/yanctab/shclap/issues
.SH AUTHOR
Written by yanctab.
.SH COPYRIGHT
Copyright \(co 2026 yanctab. License: Apache-2.0.
